<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Calculator Rețetă Premium</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family:'Segoe UI', sans-serif; background:#f4f6f8; margin:0; padding:0; color:#333; }
nav { background:#336699; overflow:hidden; }
nav a { float:left; display:block; color:white; text-align:center; padding:14px 20px; text-decoration:none; }
nav a:hover { background:#C0C0C0; }
.section { display:none; padding:20px; }
.active { display:block; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; }
th, td { padding:10px; border:1px solid #ccc; text-align:left; }
input, select { width:100%; padding:6px; box-sizing:border-box; }
button { padding:10px 16px; background:#2980b9; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer; margin-right:10px; margin-top:10px; transition:0.3s; }
button:hover { background:#2471a3; transform:scale(1.05); }
.result { background:#ecf0f1; padding:20px; border-radius:8px; }

#materiePrimaTable tbody, #retetarTable tbody, #tabelProduse tbody { max-height:300px; overflow-y:auto; display:block; }
#materiePrimaTable thead, #retetarTable thead, #tabelProduse thead { display:table; width:100%; table-layout:fixed; }
#materiePrimaTable tbody tr, #retetarTable tbody tr, #tabelProduse tbody tr { display:table; width:100%; table-layout:fixed; }
#searchIngredient { margin-bottom:10px; padding:6px; width:100%; }

header { position:relative; color:white; padding:100px 20px; text-align:center; overflow:hidden; }
header h1, header p { position:relative; z-index:2; margin:0; text-shadow:2px 2px 6px rgba(0,0,0,0.7); }
header h1 { font-size:3em; margin-bottom:10px; }
header p { font-size:1.5em; }
#headerBackground { position:absolute; top:0; left:0; width:100%; height:100%; background-size:cover; background-position:center; z-index:1; animation: zoom 20s infinite alternate; }
@keyframes zoom { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

#rezultate h2 { text-align:center; }
#rezultate .buttons-container { text-align:center; margin-top:15px; }

#adaugaIngredientBtn { margin-bottom:15px; }

#tabelProduse-container { max-height:400px; overflow-y:auto; overflow-x:hidden; width:80%; margin:0 auto; border:1px solid #ccc; border-radius:6px; }
#tabelProduse tr:nth-child(even) { background:#f2f2f2; }
#tabelProduse th { position:sticky; top:0; background:#2980b9; color:white; z-index:2; }
#tabelProduse td, #tabelProduse th { padding:10px; border:1px solid #ccc; text-align:left; }

#monitorPretTable { width:80%; margin:0 auto 20px auto; border-collapse:collapse; }
#monitorPretTable th, #monitorPretTable td { border:1px solid #ccc; padding:8px; text-align:left; }
#monitorPretTable th { background:#2980b9; color:white; }
#monitorPretTable tr:nth-child(even) { background:#f2f2f2; }

.pretCrestere { color:green; font-weight:bold; transition: background 0.5s; }
.pretScadere { color:red; font-weight:bold; transition: background 0.5s; }
.highlight { background:yellow; transition: background 1s; }

#filtrarePret { margin-bottom:10px; width:50%; padding:5px; }
</style>
</head>
<body>

<header>
<div id="headerBackground" style="background-image:url("D:\10. Calculatoare produse\004. Calculator reteta\819C1498.jpg");"></div>
<h1>Calculator rețetă</h1>
<p>Ciubotelele dulci</p>
</header>

<nav>
<a href="#" onclick="showSection('materiePrima')">Materie Primă</a>
<a href="#" onclick="showSection('retetar')">Rețetar</a>
<a href="#" onclick="showSection('rezultate')">Rezultate</a>
</nav>

<!-- Materie Primă -->
<div id="materiePrima" class="section">
<h2>Materie Primă</h2>
<input type="text" id="searchIngredient" placeholder="Caută ingredient..." onkeyup="cautaIngredient()">
<table id="materiePrimaTable">
<thead><tr><th>Ingredient</th><th>Preț achiziție (RON)</th><th>Gramaj achiziționat (g)</th></tr></thead>
<tbody></tbody>
</table>
<button type="button" onclick="adaugaMateriePrima()">Adaugă materie primă</button>
<button type="button" onclick="salveazaMateriePrima()">Salvează materie primă</button>
<button type="button" onclick="exportaMateriePrima()">Exportă materie primă</button>
<input type="file" id="importFileMP" onchange="importaMateriePrima(event)" style="display:none;">
<button type="button" onclick="document.getElementById('importFileMP').click()">Importă materie primă</button>

<h3>Monitorizare preț materie primă</h3>
<select id="filtrarePret" onchange="afiseazaMonitorPret()">
<option value="toate">Toate</option>
<option value="crestere">Doar creșteri</option>
<option value="scadere">Doar scăderi</option>
<option value="procent5">>5%</option>
<option value="procent10">>10%</option>
</select>
<button type="button" onclick="exportaMonitorPret()">Export monitorizare</button>
<table id="monitorPretTable">
<thead><tr><th>Ingredient</th><th>% Schimbare</th></tr></thead>
<tbody></tbody>
</table>
<canvas id="graficPreturi" width="400" height="200"></canvas>
</div>

<!-- Rețetar -->
<div id="retetar" class="section">
<form id="retetaForm" onsubmit="return false;">
<h2>Rețetar Produs Finit</h2>
<label>Nume produs finit:</label>
<input type="text" id="numeProdus" placeholder="Ex: Ecler">
<label>Categorie:</label>
<select id="categorieProdus">
<option value="Ecler">Ecler</option>
<option value="Tartă">Tartă</option>
<option value="Baton">Baton</option>
<option value="Altele">Altele</option>
</select>

<table id="retetarTable">
<thead><tr><th>Ingredient</th><th>Gramaj folosit (g)</th></tr></thead>
<tbody>
<tr>
<td><input type="text" placeholder="Ex: Zahăr"></td>
<td><input type="number" step="0.1" class="gramajRetetar"></td>
</tr>
</tbody>
</table>
<button type="button" id="adaugaIngredientBtn" onclick="adaugaRandRetetar()">Adaugă ingredient în rețetă</button>

<label>Gramaj rezultat final (g):</label>
<input type="number" id="gramajFinal">
<label>Marja de profit (%):</label>
<input type="number" id="marjaProfit" value="30">
<label>Durata manoperă (ore):</label>
<input type="number" id="durataManopera">
<label>Salariu minim brut lunar (RON):</label>
<input type="number" id="salariuMinim" value="3700">

<button type="button" onclick="calculeazaReteta()">Calculează</button>
<button type="button" onclick="salveazaProdus()">Salvează produs</button>
<p id="profitEstimativ" style="font-weight:bold;margin-top:10px;"></p>
<div class="result" id="rezultat"></div>
</form>
</div>

<!-- Rezultate -->
<div id="rezultate" class="section">
<h2>Produse Finite Salvate</h2>
<div class="buttons-container">
<button type="button" onclick="exportaProduse()">Exportă produse finite</button>
<button type="button" onclick="document.getElementById('importFileProd').click()">Importă produse finite</button>
<button type="button" onclick="stergeToateProdusele()">Șterge toate produsele</button>
<input type="file" id="importFileProd" onchange="importaProduse(event)" style="display:none;">
</div>
<div id="tabelProduse-container">
<table id="tabelProduse">
<thead><tr><th>Nume produs</th><th>Categorie</th><th>Preț pe kg (RON)</th><th>Profit estimativ (RON)</th><th>Acțiuni</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
// --- JS complet ---
let materiePrimaAnterioara = JSON.parse(localStorage.getItem("materiePrima")) || [];

function showSection(id) {
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

window.onload = function() {
  showSection('materiePrima');
  incarcaMateriePrima();
  afiseazaProduse();
  afiseazaMonitorPret();
};

// Materie primă
function adaugaMateriePrima() {
  const tbody = document.querySelector("#materiePrimaTable tbody");
  const row = tbody.insertRow();
  row.innerHTML = `<td><input type="text" placeholder="Ex: Ouă"></td>
  <td><input type="number" step="0.01" class="pretMaterie"></td>
  <td><input type="number" step="0.1" class="gramajMaterie"></td>`;
  salveazaMateriePrima();
}

function salveazaMateriePrima() {
  const rows = document.querySelectorAll("#materiePrimaTable tbody tr");
  const data = [];
  rows.forEach(r=>{
    const ingredient = r.cells[0].querySelector("input").value.trim();
    const pret = parseFloat(r.cells[1].querySelector("input").value)||0;
    const gramaj = parseFloat(r.cells[2].querySelector("input").value)||0;
    if(ingredient) data.push({ingredient, pret, gramaj});
  });
  localStorage.setItem("materiePrima", JSON.stringify(data));
  afiseazaMonitorPret();
}

function incarcaMateriePrima() {
  const data = JSON.parse(localStorage.getItem("materiePrima"))||[];
  const tbody = document.querySelector("#materiePrimaTable tbody");
  tbody.innerHTML = "";
  data.forEach(item=>{
    const row = tbody.insertRow();
    row.innerHTML = `<td><input type="text" value="${item.ingredient}"></td>
    <td><input type="number" step="0.01" class="pretMaterie" value="${item.pret}"></td>
    <td><input type="number" step="0.1" class="gramajMaterie" value="${item.gramaj}"></td>`;
  });
}

// Caută
function cautaIngredient(){
  const filter = document.getElementById("searchIngredient").value.toLowerCase();
  document.querySelectorAll("#materiePrimaTable tbody tr").forEach(r=>{
    const text = r.cells[0].querySelector("input").value.toLowerCase();
    r.style.display = text.includes(filter)?"":"none";
  });
}

// Import/Export Materie Primă
function exportaMateriePrima() {
  const data = JSON.parse(localStorage.getItem("materiePrima"))||[];
  let csv="Ingredient,Preț achiziție (RON),Gramaj achiziționat (g)\n";
  data.forEach(i=>csv+=`"${i.ingredient}",${i.pret},${i.gramaj}\n`);
  const blob=new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob); link.download="materie_prima.csv"; link.click();
}

function importaMateriePrima(event){
  const file=event.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    const lines=e.target.result.split("\n").slice(1);
    const data=[];
    lines.forEach(line=>{
      const [ingredient,pret,gramaj]=line.split(",");
      if(ingredient) data.push({ingredient:ingredient.replace(/"/g,""), pret:parseFloat(pret), gramaj:parseFloat(gramaj)});
    });
    localStorage.setItem("materiePrima",JSON.stringify(data));
    incarcaMateriePrima();
  };
  reader.readAsText(file);
}

// --- Monitorizare Preț ---
function afiseazaMonitorPret(){
  const data = JSON.parse(localStorage.getItem("materiePrima"))||[];
  const tbody=document.querySelector("#monitorPretTable tbody");
  tbody.innerHTML="";
  data.forEach(item=>{
    let anterior = materiePrimaAnterioara.find(x=>x.ingredient===item.ingredient);
    let proc=0;
    if(anterior) proc=((item.pret-anterior.pret)/anterior.pret*100).toFixed(2);
    const tr=tbody.insertRow();
    tr.innerHTML=`<td>${item.ingredient}</td><td class="${proc>=0?'pretCrestere':'pretScadere'}">${proc}%</td>`;
  });
  materiePrimaAnterioara=data.map(x=>({...x}));
}

// --- Rețetar ---
function adaugaRandRetetar(){
  const tbody=document.querySelector("#retetarTable tbody");
  const row=tbody.insertRow();
  row.innerHTML=`<td><input type="text" placeholder="Ex: Zahăr"></td>
  <td><input type="number" step="0.1" class="gramajRetetar"></td>`;
}

function calculeazaReteta(){
  const ingrediente=document.querySelectorAll("#retetarTable tbody tr");
  const materieRows=JSON.parse(localStorage.getItem("materiePrima"))||[];
  let totalCost=0;
  ingrediente.forEach(r=>{
    const nume=r.cells[0].querySelector("input").value.trim().toLowerCase();
    const gramaj=parseFloat(r.cells[1].querySelector("input").value)||0;
    materieRows.forEach(m=>{
      if(nume===m.ingredient.toLowerCase()&&m.gramaj>0)
        totalCost+=m.pret*(gramaj/m.gramaj);
    });
  });
  const salariu=parseFloat(document.getElementById("salariuMinim").value)||0;
  const ore=parseFloat(document.getElementById("durataManopera").value)||0;
  const costManopera=(salariu/168)*ore;
  totalCost+=costManopera;

  const marja=parseFloat(document.getElementById("marjaProfit").value)||0;
  const gramajFinal=parseFloat(document.getElementById("gramajFinal").value)||1;
  const pretFinal=totalCost*(1+marja/100);
  const pretKg=(pretFinal/gramajFinal)*1000;
  document.getElementById("rezultat").innerHTML=`Investiție totală: ${totalCost.toFixed(2)} RON<br>
  Preț final cu marjă: ${pretFinal.toFixed(2)} RON<br>Preț pe kg vândut: ${pretKg.toFixed(2)} RON/kg`;
  let profit=pretFinal-totalCost;
  document.getElementById("profitEstimativ").innerText="Profit estimativ: "+profit.toFixed(2)+" RON";
  return {pretKg:pretKg.toFixed(2), profit:profit.toFixed(2)};
}

// --- Salvează Produs ---
function salveazaProdus(){
  const nume=document.getElementById("numeProdus").value.trim();
  if(!nume){ alert("Introdu numele produsului."); return; }
  const categorie=document.getElementById("categorieProdus").value;
  const calc=calculeazaReteta();
  let produse=JSON.parse(localStorage.getItem("produse"))||[];
  const index=produse.findIndex(p=>p.nume.toLowerCase()===nume.toLowerCase());
  if(index>=0) { produse[index]={nume, pretKg:calc.pretKg, profit:calc.profit, categorie}; }
  else { produse.push({nume, pretKg:calc.pretKg, profit:calc.profit, categorie}); }
  localStorage.setItem("produse",JSON.stringify(produse));
  afiseazaProduse();

  document.getElementById("numeProdus").value="";
  document.getElementById("gramajFinal").value="";
  document.getElementById("marjaProfit").value=30;
  document.getElementById("durataManopera").value="";
  document.querySelector("#retetarTable tbody").innerHTML=`<tr>
  <td><input type="text" placeholder="Ex: Zahăr"></td><td><input type="number" step="0.1" class="gramajRetetar"></td></tr>`;
  document.getElementById("rezultat").innerHTML="";
  document.getElementById("profitEstimativ").innerText="";
}

// --- Rezultate ---
function afiseazaProduse(){
  const produse=JSON.parse(localStorage.getItem("produse"))||[];
  const tbody=document.querySelector("#tabelProduse tbody");
  tbody.innerHTML="";
  produse.forEach((p,i)=>{
    const row=tbody.insertRow();
    row.innerHTML=`<td>${p.nume}</td><td>${p.categorie}</td><td>${p.pretKg}</td><td>${p.profit}</td>
    <td><button onclick="stergeProdus(${i})">Șterge</button></td>`;
  });
}

function stergeProdus(index){
  let produse=JSON.parse(localStorage.getItem("produse"))||[];
  produse.splice(index,1);
  localStorage.setItem("produse",JSON.stringify(produse));
  afiseazaProduse();
}

function stergeToateProdusele(){
  if(confirm("Sigur vrei să ștergi toate produsele?")){
    localStorage.removeItem("produse");
    afiseazaProduse();
  }
}

function exportaProduse(){
  const produse=JSON.parse(localStorage.getItem("produse"))||[];
  let csv="Nume produs,Categorie,Preț pe kg (RON),Profit estimativ (RON)\n";
  produse.forEach(i=>csv+=`"${i.nume}",${i.categorie},${i.pretKg},${i.profit}\n`);
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="produse_finite.csv"; link.click();
}

function importaProduse(event){
  const file=event.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    const lines=e.target.result.split("\n").slice(1);
    const data=[];
    lines.forEach(line=>{
      const [nume,categorie,pret,profit]=line.split(",");
      if(nume) data.push({nume:nume.replace(/"/g,""), categorie, pretKg:parseFloat(pret), profit:parseFloat(profit)});
    });
    localStorage.setItem("produse",JSON.stringify(data));
    afiseazaProduse();
  };
  reader.readAsText(file);
}
</script>

</body>
</html>
